@page "/sysadmin/users"
@using System.Threading
@using Savitar.Domain.Models.Dtos
@inject HttpClient Http

<BasePage Title="Users" OnInitData="OnInitDataAsync">
    @if (_items == null)
    {
        <MudContainer Class="spinner" />
    }
    else
    {
        <MudTable Items="@_items" Hover="true" Breakpoint="Breakpoint.Sm">
            <HeaderContent>
                <MudTh>Email</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="Nr">@context.Email</MudTd>
            </RowTemplate>
        </MudTable>

        <MudGrid>
            @foreach (var item in _items)
            {       
                <MudItem xs="12">
                    <MudCard Outlined="true">
                        <MudCardHeader>
                            <CardHeaderContent>
                                <MudText Typo="Typo.h6"><p>@(item.Email)</p></MudText>
                            </CardHeaderContent>
                        </MudCardHeader>
                    </MudCard>
                </MudItem>
            }
        </MudGrid>
    }

    @code {
        private IEnumerable<UserInfo> _items;

        protected async Task OnInitDataAsync(BasePageServices basePageServices)
        {
            var data = await Http.GetFromJsonAsync<UserInfo[]>("api/sysadmin/users");
            if (data == null)
            {
                _snackbar.Add("No users found", Severity.Warning);
                return;
            }

            _items = data.OrderBy(x => x.Email).ToList();
        }        
    }
</BasePage>